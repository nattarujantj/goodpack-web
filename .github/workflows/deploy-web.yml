name: Deploy Flutter Web

on:
  push:
    branches:
      - master
    paths:
      - 'flutter_app/**'
      - '.github/workflows/deploy-web.yml'
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Deploy to Ubuntu Server via SSH
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USERNAME }}
          key: ${{ secrets.SERVER_SSH_KEY }}
          port: 22
          script: |
            echo "ğŸš€ Starting Flutter Web deployment..."
            
            # Navigate to project directory
            cd /opt/goodpack-web
            
            # Pull latest code
            echo "ğŸ“¥ Pulling latest code..."
            git fetch origin
            git reset --hard origin/master
            
            # Build Flutter web
            echo "ğŸ”¨ Building Flutter web..."
            flutter pub get
            flutter build web --dart-define=API_BASE_URL="http://192.168.1.162:8080/api"
            
            # Deploy to nginx
            echo "ğŸŒ Deploying to nginx..."
            sudo rm -rf /var/www/html/*
            sudo cp -r build/web/* /var/www/html/
            sudo systemctl restart nginx
            
            echo "âœ… Flutter Web deployment complete!"

